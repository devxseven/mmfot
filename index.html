<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MM FOT</title>
    <link rel="icon" type="image/x-icon" href="/img/favicon.ico">
    <script src="https://cdn.jsdelivr.net/npm/daisyui@5.0.43/index.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.43/moment-timezone-with-data.min.js"></script>
    <script src="https://static.sonartech.io/lib/1.0.0/sonar.js?appId=app_9eebc533"></script>
    <style>
        html {
            overscroll-behavior-x: none;
        }

        body {
            min-height: 100vh;
            height: auto;
            --bg-color: var(--tg-theme-section-bg-color, #fff);
            --card-bg-color: var(--tg-theme-bg-color, #fff);
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--tg-theme-text-color, #212121);
            margin: 0;
            padding: 0;
            color-scheme: var(--tg-color-scheme);
            padding-bottom: 56px;
            /* Space for bottom nav on small screens */
        }

        body.gray {
            background-color: var(--tg-theme-section-bg-color, #f5f5f5);
        }

        section {
            text-align: center;
            background-color: var(--bg-color, #ffffff);
            padding-left: calc(var(--tg-safe-area-inset-left, 0px) + var(--tg-content-safe-area-inset-left, 0px) + 16px);
            padding-right: calc(var(--tg-safe-area-inset-right, 0px) + var(--tg-content-safe-area-inset-right, 0px) + 16px);
            padding-bottom: 16px;
        }

        .card {
            background-color: var(--card-bg-color, #ffffff);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.12), 0 2px 3px rgba(0, 0, 0, 0.24);
            border-radius: 8px;
        }

        .league,
        .home-name,
        .away-name,
        .match-date,
        .match-time {
            color: var(--tg-theme-text-color, #212121);
        }

        .button {
            background-color: var(--card-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #212121);
        }

        .no-hover:hover {
            background-color: inherit !important;
            transform: none !important;
            box-shadow: none !important;
            cursor: default !important;
        }

        .game-card img {
            width: 100%;
            height: 125px;
            object-fit: cover;
        }

        @keyframes beat {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }
        }

        .animate-beat {
            animation: beat 1s infinite;
        }

        /* Navigation Bar Styles */
        .nav-bar {
            background-color: var(--tg-theme-bg-color, #ffffff);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.12);
            z-index: 1000;
        }

        .nav-bar-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-around;
            padding: 6px 0;
            border-top: 1px solid rgba(0, 0, 0, 0.12);
        }

        .nav-bar-top {
            position: sticky;
            top: 0;
            display: flex;
            justify-content: center;
            gap: 16px;
            padding: 12px 0;
            width: 100%;
            margin-bottom: 16px;
        }

        .nav-button {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--tg-theme-text-color, #212121);
            font-size: 14px;
            font-weight: 500;
            padding: 8px 36px;
            border-radius: 8px;
            transition: background-color 0.2s, transform 0.1s;
            text-transform: uppercase;
        }

        .nav-button.active {
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
            color: var(--tg-theme-text-color, #212121);
        }

        .nav-button svg {
            width: 24px;
            height: 24px;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .select {
            background-color: var(--card-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #212121);
            border: 1px solid var(--tg-theme-text-color, #212121);
        }

        .select:hover {
            border: 1px solid var(--tg-theme-text-color, #6b7280);
            /* hover:border-gray-500 */
        }

        .select:focus {
            outline: none;
            box-shadow: 0 0 0 1px var(--tg-theme-primary-color, #2b2b2b);
            /* focus:ring-2 */
        }

        @media (min-width: 640px) {
            body {
                padding-bottom: 0;
                /* Space for top nav on larger screens */
            }

            .nav-bar-bottom {
                display: none;
            }

            .nav-bar-top {
                display: flex;
            }
        }

        @media (max-width: 639px) {
            .nav-bar-top {
                display: none;
            }

            #main {
                padding-top: calc(var(--tg-safe-area-inset-top, 0px) + var(--tg-content-safe-area-inset-top, 0px) + 16px);
            }

            .nav-bar-bottom {
                display: flex;
            }

            .nav-button {
                flex-direction: column;
                font-size: 10px;
                font-weight: 500;
                flex: 1;
                text-align: center;
                margin: 0 5px;
                gap: 1px;
                padding: 4px 36px;
            }
        }

        /* Skeleton loading for match list */
        .skeleton-container {
            display: flex;
            justify-content: center;
        }

        .skeleton-card {
            background-color: var(--card-bg-color, #ffffff);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.12), 0 2px 3px rgba(0, 0, 0, 0.24);
            border-radius: 8px;
            padding: 16px;
            animation: pulse 1.5s infinite;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .skeleton-square {
            width: 46px;
            height: 46px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            border-radius: 8px;
            animation: shimmer 1.5s infinite;
            margin-bottom: 2px;
        }

        .skeleton-line {
            width: 4rem;
            /* Equivalent to Tailwind's w-36 */
            height: 14px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            border-radius: 4px;
            animation: shimmer 1.5s infinite;
            margin: 4px;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        @keyframes shimmer {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }
    </style>
</head>

<body>
    <!-- Navigation Bar for Larger Screens -->
    <nav class="nav-bar nav-bar-top">
        <button class="nav-button active" data-tab="home">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
                <path
                    d="M240-200h120v-240h240v240h120v-360L480-740 240-560v360Zm-80 80v-480l320-240 320 240v480H520v-240H440v240H160Z" />
            </svg>
            Home
        </button>
        <button class="nav-button" data-tab="channels">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
                <path
                    d="M320-120v-80H160q-33 0-56.5-23.5T80-280v-480q0-33 23.5-56.5T160-840h640q33 0 56.5 23.5T880-760v480q0 33-23.5 56.5T800-200H640v80H320ZM160-280h640v-480H160v480Zm0 0v-480 480Z" />
            </svg>
            TV
        </button>
        <button class="nav-button" data-tab="games">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
                <path
                    d="M189-160q-60 0-102.5-43T42-307q0-9 1-18t3-18l84-336q14-54 57-87.5t98-33.5h390q55 0 98 33.5t57 87.5l84 336q2 9 3.5 18.5T919-306q0 61-43.5 103.5T771-160q-42 0-78-22t-54-60l-28-58q-5-10-15-15t-21-5H385q-11 0-21 5t-15 15l-28 58q-18 38-54 60t-78 22Zm3-80q19 0 34.5-10t23.5-27l28-57q15-31 44-48.5t63-17.5h190q34 0 63 18t45 48l28 57q8 17 23.5 27t34.5 10q28 0 48-18.5t21-46.5q0 1-2-19l-84-335q-7-27-28-44t-49-17H285q-28 0-49.5 17T208-659l-84 335q-2 6-2 18 0 28 20.5 47t49.5 19Zm348-280q17 0 28.5-11.5T580-560q0-17-11.5-28.5T540-600q-17 0-28.5 11.5T500-560q0 17 11.5 28.5T540-520Zm80-80q17 0 28.5-11.5T660-640q0-17-11.5-28.5T620-680q-17 0-28.5 11.5T580-640q0 17 11.5 28.5T620-600Zm0 160q17 0 28.5-11.5T660-480q0-17-11.5-28.5T620-520q-17 0-28.5 11.5T580-480q0 17 11.5 28.5T620-440Zm80-80q17 0 28.5-11.5T740-560q0-17-11.5-28.5T700-600q-17 0-28.5 11.5T660-560q0 17 11.5 28.5T700-520Zm-360 60q13 0 21.5-8.5T370-490v-40h40q13 0 21.5-8.5T440-560q0-13-8.5-21.5T410-590h-40v-40q0-13-8.5-21.5T340-660q-13 0-21.5 8.5T310-630v40h-40q-13 0-21.5 8.5T240-560q0 13 8.5 21.5T270-530h40v40q0 13 8.5 21.5T340-460Zm140-20Z" />
            </svg>
            Games
        </button>
    </nav>

    <!-- Fullscreen and Reload Buttons -->
    <section id="main">
        <div class="flex gap-3 justify-center">
            <button id="fullscreen_btn"
                class="btn text-sm md:text-base px-4 py-2 rounded-lg shadow-lg button h-auto min-h-[44px] no-hover flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 fill-current" viewBox="0 -960 960 960"
                    fill="var(--tg-theme-text-color, #212121)">
                    <path
                        d="M120-120v-200h80v120h120v80H120Zm520 0v-80h120v-120h80v200H640ZM120-640v-200h200v80H200v120h-80Zm640 0v-120H640v-80h200v200h-80Z" />
                </svg>
                Change Fullscreen
            </button>
            <button id="reload_btn"
                class="btn text-sm md:text-base px-4 py-2 rounded-lg shadow-lg button h-auto min-h-[44px] no-hover flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 fill-current" viewBox="0 -960 960 960"
                    fill="var(--tg-theme-text-color, #212121)">
                    <path
                        d="M480-160q-134 0-227-93t-93-227q0-134 93-227t227-93q69 0 132 28.5T720-690v-110h80v280H520v-80h168q-32-56-87.5-88T480-720q-100 0-170 70t-70 170q0 100 70 170t170 70q77 0 139-44t87-116h84q-28 106-114 173t-196 67Z" />
                </svg>
                Reload
            </button>
        </div>
    </section>

    <!-- Content Sections -->
    <section id="home" class="content-section active">
        <h5 class="text-[11px] md:text-[14px] font-bold mb-4 hidden">version 2.0</h5>
        <h2 class="text-base md:text-lg font-bold mb-2">Football Schedule Fixtures</h2>
        <div class="relative inline-block w-3/4 md:w-96 mb-4">
            <select id="matchFilter"
                class="select select-bordered w-full px-4 py-3 text-base md:text-lg font-bold rounded-lg shadow-sm">
                <option value="all">All Matches</option>
                <option value="hot">Hot Matches</option>
                <option value="live">Live Matches</option>
            </select>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4" id="matchList">
            <!-- Skeleton placeholders -->
            <div class="skeleton-container">
                <div class="skeleton-card grid grid-cols-11 gap-2 w-full mt-2 shadow-xl items-center">
                    <div class="col-span-4 flex flex-col items-center home-name">
                        <div class="skeleton-square"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="col-span-3 flex flex-col items-center match-date match-time">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="col-span-4 flex flex-col items-center away-name">
                        <div class="skeleton-square"></div>
                        <div class="skeleton-line"></div>
                    </div>
                </div>
            </div>
            <div class="skeleton-container">
                <div class="skeleton-card grid grid-cols-11 gap-2 w-full mt-2 shadow-xl items-center">
                    <div class="col-span-4 flex flex-col items-center home-name">
                        <div class="skeleton-square"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="col-span-3 flex flex-col items-center match-date match-time">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="col-span-4 flex flex-col items-center away-name">
                        <div class="skeleton-square"></div>
                        <div class="skeleton-line"></div>
                    </div>
                </div>
            </div>
            <div class="skeleton-container">
                <div class="skeleton-card grid grid-cols-11 gap-2 w-full mt-2 shadow-xl items-center">
                    <div class="col-span-4 flex flex-col items-center home-name">
                        <div class="skeleton-square"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="col-span-3 flex flex-col items-center match-date match-time">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="col-span-4 flex flex-col items-center away-name">
                        <div class="skeleton-square"></div>
                        <div class="skeleton-line"></div>
                    </div>
                </div>
            </div>
            <div class="skeleton-container">
                <div class="skeleton-card grid grid-cols-11 gap-2 w-full mt-2 shadow-xl items-center">
                    <div class="col-span-4 flex flex-col items-center home-name">
                        <div class="skeleton-square"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="col-span-3 flex flex-col items-center match-date match-time">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="col-span-4 flex flex-col items-center away-name">
                        <div class="skeleton-square"></div>
                        <div class="skeleton-line"></div>
                    </div>
                </div>
            </div>
            <div class="skeleton-container">
                <div class="skeleton-card grid grid-cols-11 gap-2 w-full mt-2 shadow-xl items-center">
                    <div class="col-span-4 flex flex-col items-center home-name">
                        <div class="skeleton-square"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="col-span-3 flex flex-col items-center match-date match-time">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="col-span-4 flex flex-col items-center away-name">
                        <div class="skeleton-square"></div>
                        <div class="skeleton-line"></div>
                    </div>
                </div>
            </div>
            <div class="skeleton-container">
                <div class="skeleton-card grid grid-cols-11 gap-2 w-full mt-2 shadow-xl items-center">
                    <div class="col-span-4 flex flex-col items-center home-name">
                        <div class="skeleton-square"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="col-span-3 flex flex-col items-center match-date match-time">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="col-span-4 flex flex-col items-center away-name">
                        <div class="skeleton-square"></div>
                        <div class="skeleton-line"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="channels" class="content-section">
        <h2 class="text-base md:text-lg font-bold mb-2">Tv Channels</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4" id="channelList"></div>
    </section>

    <section id="games" class="content-section">
        <h2 class="text-base md:text-lg font-bold mb-2">Sports Games</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 xl:grid-cols-6 gap-4" id="gameList"></div>
    </section>

    <!-- Navigation Bar for Small Screens -->
    <nav class="nav-bar nav-bar-bottom">
        <button class="nav-button active" data-tab="home">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
                <path
                    d="M240-200h120v-240h240v240h120v-360L480-740 240-560v360Zm-80 80v-480l320-240 320 240v480H520v-240H440v240H160Z" />
            </svg>
            Home
        </button>
        <button class="nav-button" data-tab="channels">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
                <path
                    d="M320-120v-80H160q-33 0-56.5-23.5T80-280v-480q0-33 23.5-56.5T160-840h640q33 0 56.5 23.5T880-760v480q0 33-23.5 56.5T800-200H640v80H320ZM160-280h640v-480H160v480Zm0 0v-480 480Z" />
            </svg>
            TV
        </button>
        <button class="nav-button" data-tab="games">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
                <path
                    d="M189-160q-60 0-102.5-43T42-307q0-9 1-18t3-18l84-336q14-54 57-87.5t98-33.5h390q55 0 98 33.5t57 87.5l84 336q2 9 3.5 18.5T919-306q0 61-43.5 103.5T771-160q-42 0-78-22t-54-60l-28-58q-5-10-15-15t-21-5H385q-11 0-21 5t-15 15l-28 58q-18 38-54 60t-78 22Zm3-80q19 0 34.5-10t23.5-27l28-57q15-31 44-48.5t63-17.5h190q34 0 63 18t45 48l28 57q8 17 23.5 27t34.5 10q28 0 48-18.5t21-46.5q0 1-2-19l-84-335q-7-27-28-44t-49-17H285q-28 0-49.5 17T208-659l-84 335q-2 6-2 18 0 28 20.5 47t49.5 19Zm348-280q17 0 28.5-11.5T580-560q0-17-11.5-28.5T540-600q-17 0-28.5 11.5T500-560q0 17 11.5 28.5T540-520Zm80-80q17 0 28.5-11.5T660-640q0-17-11.5-28.5T620-680q-17 0-28.5 11.5T580-640q0 17 11.5 28.5T620-600Zm0 160q17 0 28.5-11.5T660-480q0-17-11.5-28.5T620-520q-17 0-28.5 11.5T580-480q0 17 11.5 28.5T620-440Zm80-80q17 0 28.5-11.5T740-560q0-17-11.5-28.5T700-600q-17 0-28.5 11.5T660-560q0 17 11.5 28.5T700-520Zm-360 60q13 0 21.5-8.5T370-490v-40h40q13 0 21.5-8.5T440-560q0-13-8.5-21.5T410-590h-40v-40q0-13-8.5-21.5T340-660q-13 0-21.5 8.5T310-630v40h-40q-13 0-21.5 8.5T240-560q0 13 8.5 21.5T270-530h40v40q0 13 8.5 21.5T340-460Zm140-20Z" />
            </svg>
            Games
        </button>
    </nav>
    
    <script>
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
            tg.BackButton.hide();
        }

        const MMFotApp = {
            encryptionKey: "devxseven",
            fileName: "matches.json",
            filePath: "mdata",
            accName: "devxseven",
            apiFirst: "ghp_",
            apiSecond: "Lb8tjXZ9BggZwnUpJWneZ7NMa7Cmmo4bjZ4H",
            now: moment(),
            matchHour: 3.5,
            intId: "intmmfot",
            rewardId: "rwmmfot",
            isFullscreen: false,
            activeTab: 'home', // Track the active tab
            allMatches: [], // Store all matches for filtering
            currentFilter: 'all', // Current filter type

            init() {
                if (tg) {
                    tg.ready();
                    tg.expand();
                    this.initFullscreen();
                }
                this.initReload();
                this.initNavigation();
                this.initFilter();
                this.initLoadMatches();
                this.fetchData('data/games.json').then(games => this.displayGames(games));
                this.fetchData('data/channels.json').then(channels => this.displayChannels(channels));
                // Ensure active tab is set correctly on init
                this.updateNavigation();
                // Listen for window resize to maintain active tab state
                window.addEventListener('resize', () => this.updateNavigation());
            },

            initFullscreen() {
                if (!tg) return;
                const fullscreenBtn = document.getElementById('fullscreen_btn');
                fullscreenBtn.addEventListener('click', () => this.toggleFullscreen(fullscreenBtn));

                tg.onEvent('fullscreenChanged', () => this.updateFullscreenButton(fullscreenBtn));
                tg.onEvent('fullscreenFailed', (params) => {
                    if (params.error === 'ALREADY_FULLSCREEN') {
                        this.updateFullscreenButton(fullscreenBtn);
                    } else {
                        tg.showAlert('Fullscreen failed: ' + params.error);
                    }
                });
                this.updateFullscreenButton(fullscreenBtn);
            },

            toggleFullscreen(el) {
                if (tg.isFullscreen) {
                    tg.exitFullscreen();
                    this.isFullscreen = false;
                } else {
                    tg.requestFullscreen();
                    this.isFullscreen = true;
                }
            },

            updateFullscreenButton(el) {
                if (tg.isFullscreen) {
                    el.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 fill-current" viewBox="0 -960 960 960"
                            fill="var(--tg-theme-text-color, #212121)">
                            <path 
                                d="M240-120v-120H120v-80h200v200h-80Zm400 0v-200h200v80H720v120h-80ZM120-640v-80h120v-120h80v200H120Zm520 0v-200h80v120h120v80H640Z"/>
                        </svg>
                        Exit Fullscreen`;
                    this.isFullscreen = true;
                } else {
                    el.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 fill-current" viewBox="0 -960 960 960"
                            fill="var(--tg-theme-text-color, #212121)">
                            <path
                                d="M120-120v-200h80v120h120v80H120Zm520 0v-80h120v-120h80v200H640ZM120-640v-200h200v80H200v120h-80Zm640 0v-120H640v-80h200v200h-80Z" />
                        </svg>
                        Change Fullscreen`;
                    this.isFullscreen = false;
                }
            },

            initReload() {
                const reloadBtn = document.getElementById('reload_btn');
                reloadBtn.addEventListener('click', () => this.reloadApp());
            },

            reloadApp() {
                window.location.reload();
            },

            initNavigation() {
                const navButtons = document.querySelectorAll('.nav-button');
                const sections = document.querySelectorAll('.content-section');

                navButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        // Update active tab
                        this.activeTab = button.getAttribute('data-tab');
                        this.updateNavigation();
                    });
                });
            },

            initFilter() {
                const matchFilter = document.getElementById('matchFilter');
                matchFilter.addEventListener('change', (e) => {
                    this.matchFilter = e.target.value;
                    this.upcomingMatchesView(this.filterMatches(this.matches));
                });
            },

            updateNavigation() {
                const navButtons = document.querySelectorAll('.nav-button');
                const sections = document.querySelectorAll('.content-section');

                // Remove active class from all buttons and sections
                navButtons.forEach(btn => btn.classList.remove('active'));
                sections.forEach(section => section.classList.remove('active'));

                // Add active class to the current tab's button and section
                navButtons.forEach(button => {
                    if (button.getAttribute('data-tab') === this.activeTab) {
                        button.classList.add('active');
                    }
                });
                document.getElementById(this.activeTab).classList.add('active');
            },

            initLoadMatches() {
                const key = 'ghp_NSe';
                const defaultValue = '8ALuVwWUOHdLS3U54FsHJBKySNJ00tLOQ';

                this.loadMatchesWithKey(key, defaultValue)
                    .then(matches => {
                        this.upcomingMatchesView(matches);
                    })
                    .catch(error => {
                        console.warn('loadMatchesWithKey failed, attempting loadMatches:', error);
                        this.loadMatches()
                            .then(matches => {
                                this.upcomingMatchesView(matches);
                            })
                            .catch(fallbackError => {
                                console.error('loadMatches failed:', fallbackError);
                                document.getElementById('matchList').innerHTML = '<p class="text-center text-red-500">Unable to load matches. Please try again later.</p>';
                            });
                    });
            },

            decryptString(encryptedBase64, key) {
                if (!encryptedBase64 || typeof encryptedBase64 !== 'string') return '';
                if (!key) return encryptedBase64;

                try {
                    const decoded = atob(encryptedBase64);
                    let decrypted = "";
                    for (let i = 0; i < decoded.length; i++) {
                        const charCode = decoded.charCodeAt(i) ^ key.charCodeAt(i % key.length);
                        decrypted += String.fromCharCode(charCode);
                    }
                    return decodeURIComponent(decrypted);
                } catch (error) {
                    return encryptedBase64;
                }
            },

            decryptObject(encryptedObj, key) {
                if (!encryptedObj || typeof encryptedObj !== 'object') return {};
                const decryptedObj = {};
                for (const [k, v] of Object.entries(encryptedObj)) {
                    try {
                        const decryptedKey = this.decryptString(k, key);
                        const decryptedValue = JSON.parse(this.decryptString(v, key));
                        decryptedObj[decryptedKey] = decryptedValue;
                    } catch (error) {
                        decryptedObj[k] = v;
                    }
                }
                return decryptedObj;
            },

            async fetchAndDecryptJson() {
                const response = await fetch(`https://raw.githubusercontent.com/${this.accName}/${this.filePath}/refs/heads/main/${this.fileName}`);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const encryptedData = await response.json();
                const decryptedData = this.decryptObject(encryptedData, this.encryptionKey);
                return decryptedData.context || [];
            },

            async fetchAndDecryptJsonWithKey(key, value) {
                const url = `https://api.github.com/repos/${this.accName}/${this.filePath}/contents/${this.fileName}`;
                const response = await fetch(url, {
                    headers: {
                        "Authorization": `token ${key}${value}`,
                        "User-Agent": "GitHub-Admin-Panel"
                    }
                });
                const data = await response.json();
                const content = JSON.parse(atob(data.content));
                const decryptedData = this.decryptObject(content, this.encryptionKey);
                return decryptedData.context || [];
            },

            async loadMatches() {
                const matches = await this.fetchAndDecryptJson();
                this.matches = matches; // Store unfiltered matches
                return this.filterMatches(matches);
            },

            async loadMatchesWithKey(key, value) {
                const matches = await this.fetchAndDecryptJsonWithKey(key, value);
                this.matches = matches; // Store unfiltered matches
                return this.filterMatches(matches);
            },

            filterMatches(matches) {
                const selectedLeagues = ['Premier League', 'La Liga', 'Serie A', 'Bundesliga', 'Ligue 1', 'MLS',
                    'UEFA Champions League', 'UEFA Europa League', 'UEFA Nations League', 'Saudi Pro League', 'UEFA Conference League',
                    'Coppa Italia', 'FA Cup', 'Copa del Rey', 'AFC Champions League Elite', 'Concacaf Champions Cup',
                    'World Cup qualification (AFC)', 'World Cup qualification (CONMEBOL)', 'World Cup qualification (UEFA)', 'AFC Asian Cup qualification',
                    'World Cup qualification (CONCACAF)', 'AFC Asian Cup qualification', 'FIFA Club World Cup'];
                if (this.matchFilter === 'hot') {
                    return matches.filter(match => selectedLeagues.includes(match.league));
                } else if (this.matchFilter === 'live') {
                    return matches.filter(match => match.match_status);
                }
                return matches;
            },

            upcomingMatchesView(matches) {
                const matchList = document.getElementById('matchList');
                const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                matchList.innerHTML = '';

                if (matches.length === 0) {
                    matchList.innerHTML = '<p class="text-center text-gray-600">No upcoming matches found.</p>';
                    return;
                }

                matches.forEach(match => {
                    // Convert match_time to user's local timezone
                    const matchDateTime = moment.tz(match.match_time * 1000, userTimezone);
                    const isLive = match.match_status;

                    // Format date and time for display in user's local timezone
                    const formattedDate = matchDateTime.format('MMM D');
                    const formattedTime = matchDateTime.format('hh:mm A');

                    const card = document.createElement('div');
                    card.className = 'card shadow-xl p-1 flex flex-col items-center';
                    card.innerHTML = `
                        <h2 class="text-xs md:text-sm p-1 font-bold text-center league">${match.league || ''}</h2>
                        <div class="grid grid-cols-11 gap-2 w-full text-center mt-2">
                            <div class="col-span-4 flex flex-col items-center home-name">
                                <img src="${match.home_img || ''}" alt="Home Team" class="w-12 h-12 object-cover" loading="lazy" onerror="this.src='default-image.png'">
                                <p class="text-[9px] md:text-[11px] pt-1 font-semibold">${match.home_name || ''}</p>
                            </div>
                            <div class="col-span-3 flex flex-col items-center match-date match-time">
                                <p class="text-xs md:text-sm font-semibold">${formattedDate || ''}</p>
                                <p class="text-xs md:text-sm font-bold">${formattedTime || ''}</p>
                                ${isLive ? '<p class="text-xs md:text-sm text-red-500 font-bold animate-beat">â¬¤ LIVE</p>' : ''}
                            </div>
                            <div class="col-span-4 flex flex-col items-center away-name">
                                <img src="${match.away_img || ''}" alt="Away Team" class="w-12 h-12 object-cover" loading="lazy" onerror="this.src='default-image.png'">
                                <p class="text-[9px] md:text-[11px] pt-1 font-semibold">${match.away_name || ''}</p>
                            </div>
                        </div>
                    `;

                    let clickCount = 0;
                    card.addEventListener('click', () => {
                        if (match.id) {
                            // Combine user agent and screen width for better accuracy
                            if (window.Sonar) {
                                const adUnits = [this.intId, this.rewardId];
                                const selectedAdUnit = adUnits[Math.floor(Math.random() * adUnits.length)];

                                if (selectedAdUnit === this.intId) {
                                    window.Sonar.show({
                                        adUnit: this.intId,
                                        onClose: () => {
                                            window.location.href = `player.html?id=${match.id}&fullscreen=${this.isFullscreen}`;
                                        },
                                    }).then((showResult) => {
                                        if (showResult?.status === 'error') {
                                            window.open('https://www.profitableratecpm.com/ewdrwi8p?key=c3f8195dd58a3e2c408fed211cc8ddee', '_blank');
                                            window.location.href = `player.html?id=${match.id}&fullscreen=${this.isFullscreen}`;
                                        }
                                    }).catch((error) => {
                                        window.open('https://www.profitableratecpm.com/ewdrwi8p?key=c3f8195dd58a3e2c408fed211cc8ddee', '_blank');
                                        window.location.href = `player.html?id=${match.id}&fullscreen=${this.isFullscreen}`;
                                    });
                                } else {
                                    window.Sonar.show({
                                        adUnit: this.rewardId,
                                        onClose: () => {
                                            window.location.href = `player.html?id=${match.id}&fullscreen=${this.isFullscreen}`;
                                        },
                                        onReward: () => {
                                            window.location.href = `player.html?id=${match.id}&fullscreen=${this.isFullscreen}`;
                                        },
                                    }).then((showResult) => {
                                        if (showResult?.status === 'error') {
                                            window.open('https://www.profitableratecpm.com/ewdrwi8p?key=c3f8195dd58a3e2c408fed211cc8ddee', '_blank');
                                            window.location.href = `player.html?id=${match.id}&fullscreen=${this.isFullscreen}`;
                                        }
                                    }).catch((error) => {
                                        window.open('https://www.profitableratecpm.com/ewdrwi8p?key=c3f8195dd58a3e2c408fed211cc8ddee', '_blank');
                                        window.location.href = `player.html?id=${match.id}&fullscreen=${this.isFullscreen}`;
                                    });
                                }
                            } else {
                                window.open('https://www.profitableratecpm.com/ewdrwi8p?key=c3f8195dd58a3e2c408fed211cc8ddee', '_blank');
                                window.location.href = `player.html?id=${match.id}&fullscreen=${this.isFullscreen}`;
                            }
                        }
                    });

                    matchList.appendChild(card);
                });
            },

            async fetchData(url) {
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`Network response was not ok: ${response.status}`);
                    const data = await response.json();
                    return data || [];
                } catch (error) {
                    document.getElementById('gameList').innerHTML = '<p class="text-center text-red-500">Error loading games: ' + error.message + '</p>';
                    return [];
                }
            },

            displayGames(games) {
                const gameList = document.getElementById('gameList');
                gameList.innerHTML = '';

                if (games.length === 0) {
                    gameList.innerHTML = '<p class="text-center text-gray-600">No games found.</p>';
                    return;
                }
                const shuffledGames = [...games].sort(() => Math.random() - 0.5);
                shuffledGames.forEach(game => {
                    const card = document.createElement('div');
                    card.className = 'card shadow-xl game-card cursor-pointer';
                    card.innerHTML = `
                        <img src="${game.image}" class="rounded-lg" loading="lazy" onerror="this.src='default-image.png'">
                    `;
                    card.addEventListener('click', () => {
                        // Combine user agent and screen width for better accuracy
                        if (window.Sonar) {
                            window.Sonar.show({
                                adUnit: this.rewardId,
                                onClose: () => {
                                    window.location.href = `game.html?url=${encodeURIComponent(game.embed)}&fullscreen=${this.isFullscreen}`;
                                },
                                onReward: () => {
                                    window.location.href = `game.html?url=${encodeURIComponent(game.embed)}&fullscreen=${this.isFullscreen}`;
                                },
                            }).then((showResult) => {
                                if (showResult?.status === 'error') {
                                    window.location.href = `game.html?url=${encodeURIComponent(game.embed)}&fullscreen=${this.isFullscreen}`;
                                }
                            }).catch((error) => {
                                window.location.href = `game.html?url=${encodeURIComponent(game.embed)}&fullscreen=${this.isFullscreen}`;
                            });
                        } else {
                            window.open('https://www.profitableratecpm.com/ewdrwi8p?key=c3f8195dd58a3e2c408fed211cc8ddee', '_blank');
                            window.location.href = `game.html?url=${encodeURIComponent(game.embed)}&fullscreen=${this.isFullscreen}`;
                        }
                    });
                    gameList.appendChild(card);
                });
            },


            displayChannels(channels) {
                const channelList = document.getElementById('channelList');
                channelList.innerHTML = '';

                if (channels.length === 0) {
                    channelList.innerHTML = '<p class="text-center text-gray-600">No Channels found.</p>';
                    return;
                }

                channels.forEach(channel => {
                    const card = document.createElement('div');
                    card.className = 'card shadow-xl cursor-pointer flex items-center justify-center h-24 rounded-lg';
                    card.innerHTML = `
        <span class="text-sm md:text-lg font-bold text-center">${channel.name}</span>
    `;
                    card.addEventListener('click', () => {

                        if (window.Sonar) {
                            window.Sonar.show({
                                adUnit: this.rewardId,
                                onClose: () => {
                                    window.location.href = `ch-player.html?url=${encodeURIComponent(channel.url)}&fullscreen=${this.isFullscreen}`;
                                },
                                onReward: () => {
                                    window.location.href = `ch-player.html?url=${encodeURIComponent(channel.url)}&fullscreen=${this.isFullscreen}`;
                                },
                            }).then((showResult) => {
                                if (showResult?.status === 'error') {
                                    window.location.href = `ch-player.html?url=${encodeURIComponent(channel.url)}&fullscreen=${this.isFullscreen}`;
                                }
                            }).catch((error) => {
                                window.location.href = `ch-player.html?url=${encodeURIComponent(channel.url)}&fullscreen=${this.isFullscreen}`;
                            });
                        } else {
                            window.open('https://www.profitableratecpm.com/ewdrwi8p?key=c3f8195dd58a3e2c408fed211cc8ddee', '_blank');
                            window.location.href = `ch-player.html?url=${encodeURIComponent(channel.url)}&fullscreen=${this.isFullscreen}`;
                        }

                    });
                    channelList.appendChild(card);
                });
            },
        };

        MMFotApp.init();
    </script>
</body>

</html>